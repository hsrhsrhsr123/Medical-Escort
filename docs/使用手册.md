# 医疗陪诊Agent - 使用手册

## 目录

1. [快速开始](#快速开始)
2. [用户管理](#用户管理)
3. [症状分析](#症状分析)
4. [预约挂号](#预约挂号)
5. [就医指导](#就医指导)
6. [用药管理](#用药管理)
7. [常见问题](#常见问题)

## 快速开始

### 第一步：创建用户档案

为老人创建一个用户账号，填写基本信息和健康档案：

```python
import requests

# 创建用户
response = requests.post(
    "http://localhost:8000/api/users/",
    json={
        "name": "张大爷",
        "phone": "13800138000",
        "age": 72,
        "gender": "男",
        "address": "北京市朝阳区XX街道XX小区",
        "emergency_contact_name": "张小明",
        "emergency_contact_phone": "13900139000",
        "chronic_diseases": "高血压、糖尿病",
        "allergies": "青霉素过敏"
    }
)

user = response.json()
user_id = user["id"]
print(f"用户创建成功，ID: {user_id}")
```

### 第二步：症状分析

当老人感觉不舒服时，描述症状让AI分析：

```python
# 症状分析
response = requests.post(
    "http://localhost:8000/api/appointments/analyze-symptoms",
    json={
        "user_id": user_id,
        "symptoms": "最近三天一直头晕，有时候感觉心慌，走路也没力气"
    }
)

analysis = response.json()
print(f"推荐科室: {analysis['recommended_department']}")
print(f"紧急程度: {analysis['urgency']}")
print(f"建议: {analysis['advice']}")
```

### 第三步：搜索医院并预约

根据推荐的科室搜索附近的医院：

```python
# 搜索医院
response = requests.get(
    "http://localhost:8000/api/appointments/hospitals",
    params={
        "location": "朝阳区",
        "department": "心血管内科"
    }
)

hospitals = response.json()["hospitals"]
for hospital in hospitals:
    print(f"{hospital['name']} - {hospital['distance']} - {hospital['level']}")

# 选择医院并创建预约
hospital = hospitals[0]
response = requests.post(
    "http://localhost:8000/api/appointments/",
    json={
        "user_id": user_id,
        "hospital_id": hospital["id"],
        "hospital_name": hospital["name"],
        "department": "心血管内科",
        "appointment_date": "2024-01-15T09:00:00",
        "symptoms": "头晕、心慌、乏力"
    }
)

appointment = response.json()
appointment_id = appointment["id"]
print(f"预约成功！预约号: {appointment['appointment_number']}")
```

### 第四步：获取就医指导

获取完整的就医流程指导：

```python
# 获取完整指导
response = requests.get(
    f"http://localhost:8000/api/guidance/appointment/{appointment_id}/full"
)

guidance = response.json()

# 显示就医须知
print("\n【就医须知】")
for reminder in guidance["important_reminders"]:
    print(f"• {reminder}")

# 显示流程步骤
print("\n【就医流程】")
for step_key, step_info in guidance["process"].items():
    print(f"\n{step_info['name']}:")
    for i, instruction in enumerate(step_info['steps'], 1):
        print(f"  {i}. {instruction}")
```

## 用户管理

### 查询用户信息

```python
# 通过ID查询
response = requests.get(f"http://localhost:8000/api/users/{user_id}")
user = response.json()

# 通过手机号查询
response = requests.get(f"http://localhost:8000/api/users/phone/13800138000")
user = response.json()
```

### 更新用户信息

```python
response = requests.put(
    f"http://localhost:8000/api/users/{user_id}",
    json={
        "address": "新地址",
        "emergency_contact_phone": "新的紧急联系电话"
    }
)
```

### 获取健康档案

```python
response = requests.get(f"http://localhost:8000/api/users/{user_id}/health-profile")
profile = response.json()
```

## 症状分析

### 支持的症状描述

系统可以理解自然语言描述的症状，例如：

- "头疼了三天，还有点发烧"
- "肚子疼，拉肚子"
- "胸口闷，喘不上气"
- "腰疼，弯不下腰"
- "眼睛看不清楚，模糊"

### 推荐科室列表

系统支持以下科室：
- 内科、外科、妇科、儿科
- 骨科、神经内科、心血管内科
- 消化内科、呼吸内科、内分泌科
- 皮肤科、眼科、耳鼻喉科
- 口腔科、泌尿外科、胸外科
- 等等

### 紧急程度评估

- **urgent（紧急）**: 建议立即就医或拨打120
- **semi-urgent（较急）**: 建议当天就医
- **normal（普通）**: 可以预约门诊

## 预约挂号

### 查看可预约时间

```python
response = requests.get(
    f"http://localhost:8000/api/appointments/hospitals/{hospital_id}/slots",
    params={
        "department": "心血管内科",
        "date": "2024-01-15"
    }
)

slots = response.json()["slots"]
for slot in slots:
    if slot["available"]:
        print(f"{slot['time']} - {slot['doctor']} ({slot['title']})")
```

### 查看预约状态

```python
response = requests.get(
    f"http://localhost:8000/api/appointments/{appointment_id}/status"
)

status = response.json()
print(f"状态: {status['status']}")
print(f"排队人数: {status['queue_number']}")
print(f"预计等待时间: {status['estimated_wait_time']}")
```

### 取消预约

```python
response = requests.put(
    f"http://localhost:8000/api/appointments/{appointment_id}/cancel"
)
```

### 查看用户的所有预约

```python
response = requests.get(
    f"http://localhost:8000/api/appointments/user/{user_id}/appointments",
    params={"status": "confirmed"}  # pending, confirmed, completed, cancelled
)

appointments = response.json()["appointments"]
```

## 就医指导

### 获取特定步骤的详细指导

```python
# 挂号取号指导
response = requests.post(
    "http://localhost:8000/api/guidance/step",
    json={
        "user_id": user_id,
        "appointment_id": appointment_id,
        "current_step": "registration"  # 可选: registration, waiting, consultation, examination, payment, pharmacy
    }
)

guidance = response.json()
print(f"\n【{guidance['step_name']}】")
for step in guidance['steps']:
    print(f"• {step}")

print(f"\n温馨提示:")
for tip in guidance['tips']:
    print(f"• {tip}")
```

### 获取医院内位置指引

```python
response = requests.post(
    "http://localhost:8000/api/guidance/location",
    json={
        "hospital_id": "h001",
        "target_location": "药房"  # 或: 检验科, 收费处, 放射科 等
    }
)

location = response.json()
print(f"位置: {location['description']}")
print("\n路线:")
for step in location['route']:
    print(f"• {step}")
```

### 语音指导

```python
# 获取适合语音播报的文本
response = requests.get(
    "http://localhost:8000/api/guidance/voice/registration",
    params={"language": "zh-CN"}
)

voice_text = response.json()["text"]
# 可以接入文字转语音服务（如百度TTS、讯飞等）进行播报
```

## 用药管理

### 解析处方

```python
prescription_text = """
处方：
1. 阿司匹林肠溶片 100mg 每日1次 晚饭后服用
2. 缬沙坦胶囊 80mg 每日1次 早晨服用
3. 二甲双胍片 500mg 每日3次 饭后服用
疗程：长期
"""

response = requests.post(
    "http://localhost:8000/api/medications/parse-prescription",
    json={"prescription_text": prescription_text}
)

result = response.json()
```

### 获取用药说明

```python
response = requests.post(
    "http://localhost:8000/api/medications/instructions",
    json={
        "user_id": user_id,
        "medication_name": "阿司匹林肠溶片"
    }
)

instructions = response.json()
print(instructions["instructions"])
print("\n语音指导:")
print(instructions["voice_guide"])
```

### 创建用药时间表

```python
medications = [
    {
        "name": "阿司匹林肠溶片",
        "dosage": "100mg",
        "frequency": "每日1次",
        "timing": "晚饭后",
        "duration": "长期"
    },
    {
        "name": "二甲双胍片",
        "dosage": "500mg",
        "frequency": "每日3次",
        "timing": "饭后",
        "duration": "长期"
    }
]

response = requests.post(
    "http://localhost:8000/api/medications/schedule",
    json={"medications": medications}
)

schedule = response.json()["schedule"]
print("\n您的用药时间安排：")
print(f"早上: {len(schedule['morning'])}种药")
print(f"中午: {len(schedule['noon'])}种药")
print(f"晚上: {len(schedule['evening'])}种药")
```

### 生成用药提醒

```python
response = requests.post(
    "http://localhost:8000/api/medications/reminders",
    json={
        "user_id": user_id,
        "medications": medications,
        "start_date": "2024-01-15"
    }
)

reminders = response.json()["reminders"]
print(f"已生成 {len(reminders)} 条用药提醒")

# 可以将提醒发送到手机或设置闹钟
for reminder in reminders[:5]:  # 显示前5条
    print(f"{reminder['date']} {reminder['time']} - {reminder['message']}")
```

### 检查药物相互作用

```python
response = requests.post(
    "http://localhost:8000/api/medications/check-interactions",
    json=["阿司匹林", "缬沙坦", "二甲双胍"]
)

result = response.json()
if result["has_interactions"]:
    print("警告：发现药物相互作用")
    for warning in result["warnings"]:
        print(f"• {warning}")
else:
    print("这些药物可以一起服用")
```

## 常见问题

### Q1: 如何修改预约时间？

A: 先取消原预约，然后重新创建新的预约。

```python
# 取消原预约
requests.put(f"http://localhost:8000/api/appointments/{old_appointment_id}/cancel")

# 创建新预约
requests.post("http://localhost:8000/api/appointments/", json={...})
```

### Q2: 忘记了预约信息怎么办？

A: 查询用户的所有预约记录。

```python
response = requests.get(
    f"http://localhost:8000/api/appointments/user/{user_id}/appointments"
)
```

### Q3: 如何添加家属账号？

A: 在用户信息中设置紧急联系人，家属可以通过紧急联系人电话查询老人的就医信息。

### Q4: 系统支持哪些医院？

A: 当前版本使用模拟数据。实际部署时需要对接各医院的预约系统API。

### Q5: 如何设置用药提醒？

A: 使用`/api/medications/reminders`接口生成提醒列表，然后可以：
- 集成到手机App的本地通知
- 发送到微信/短信
- 接入智能音箱

### Q6: 老人不会用手机怎么办？

A: 建议：
1. 子女帮忙完成预约和设置
2. 使用语音交互功能
3. 打印纸质版就医指导
4. 让医院志愿者协助

### Q7: 数据安全吗？

A: 系统采用多重安全措施：
- 数据加密存储
- API访问认证
- 操作日志记录
- 符合医疗数据保护规范

### Q8: 遇到紧急情况怎么办？

A: 
1. 立即拨打120急救电话
2. 联系紧急联系人
3. 前往最近医院的急诊科
4. 本系统不能替代紧急医疗救助

## 技术支持

如需帮助，请联系：
- 技术支持热线：400-XXX-XXXX
- 邮箱：support@medical-escort.com
- 在线客服：工作日 9:00-18:00

---

祝您和家人身体健康！❤️




