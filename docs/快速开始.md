# 快速开始指南

## 5分钟快速上手

### 第一步：安装依赖

```bash
# 进入项目目录
cd "Medical Escort"

# 创建虚拟环境（推荐）
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# 或者
venv\Scripts\activate  # Windows

# 安装依赖
pip install -r requirements.txt
```

### 第二步：配置环境变量

创建 `.env` 文件：

```bash
# 复制示例配置
cp .env.example .env

# 编辑.env文件，填入你的OpenAI API Key
# OPENAI_API_KEY=sk-your-api-key-here
```

### 第三步：启动服务

```bash
# 使用启动脚本（推荐）
./start.sh

# 或者手动启动
cd api
python main.py
```

服务启动后，访问 http://localhost:8000/docs 查看API文档。

### 第四步：运行示例

在新的终端窗口：

```bash
# 确保虚拟环境已激活
source venv/bin/activate

# 运行示例程序
python examples/example_usage.py
```

## 完整使用流程示例

### 场景：王奶奶需要看病

**1. 子女帮王奶奶创建账号**

```python
import requests

# 创建用户
response = requests.post(
    "http://localhost:8000/api/users/",
    json={
        "name": "王奶奶",
        "phone": "13800138888",
        "age": 75,
        "gender": "女",
        "emergency_contact_name": "王小华",
        "emergency_contact_phone": "13900139999"
    }
)

user_id = response.json()["id"]
```

**2. 王奶奶说她的症状**

```python
# AI分析症状
response = requests.post(
    "http://localhost:8000/api/appointments/analyze-symptoms",
    json={
        "user_id": user_id,
        "symptoms": "胸闷，喘不上气，心慌"
    }
)

result = response.json()
print(f"推荐科室: {result['recommended_department']}")
# 输出: 推荐科室: 心血管内科
```

**3. 搜索附近医院并预约**

```python
# 搜索医院
response = requests.get(
    "http://localhost:8000/api/appointments/hospitals",
    params={
        "location": "海淀区",
        "department": "心血管内科"
    }
)

hospitals = response.json()["hospitals"]
hospital = hospitals[0]  # 选择第一家

# 创建预约
response = requests.post(
    "http://localhost:8000/api/appointments/",
    json={
        "user_id": user_id,
        "hospital_id": hospital["id"],
        "hospital_name": hospital["name"],
        "department": "心血管内科",
        "appointment_date": "2024-01-15T09:00:00"
    }
)

appointment_id = response.json()["id"]
print("预约成功！")
```

**4. 王奶奶去医院，查看就医指导**

```python
# 获取完整的就医流程指导
response = requests.get(
    f"http://localhost:8000/api/guidance/appointment/{appointment_id}/full"
)

guidance = response.json()

# 显示就医须知
for reminder in guidance["important_reminders"]:
    print(f"• {reminder}")

# 王奶奶到达医院，需要挂号
response = requests.post(
    "http://localhost:8000/api/guidance/step",
    json={
        "user_id": user_id,
        "appointment_id": appointment_id,
        "current_step": "registration"
    }
)

guidance = response.json()
for step in guidance["steps"]:
    print(step)
```

**5. 看完病，获取用药指导**

```python
# 解析处方
medications = [
    {
        "name": "阿司匹林肠溶片",
        "dosage": "100mg",
        "frequency": "每日1次",
        "timing": "晚饭后",
        "duration": "长期"
    }
]

# 生成用药时间表
response = requests.post(
    "http://localhost:8000/api/medications/schedule",
    json={"medications": medications}
)

schedule = response.json()
print(schedule["summary"])

# 生成用药提醒
response = requests.post(
    "http://localhost:8000/api/medications/reminders",
    json={
        "user_id": user_id,
        "medications": medications,
        "start_date": "2024-01-15"
    }
)

reminders = response.json()["reminders"]
print(f"已生成 {len(reminders)} 条用药提醒")
```

## 核心功能速览

### 🔍 症状分析
```bash
curl -X POST "http://localhost:8000/api/appointments/analyze-symptoms" \
  -H "Content-Type: application/json" \
  -d '{"user_id": 1, "symptoms": "头晕、心慌"}'
```

### 🏥 搜索医院
```bash
curl "http://localhost:8000/api/appointments/hospitals?location=海淀区&department=心血管内科"
```

### 📅 预约挂号
```bash
curl -X POST "http://localhost:8000/api/appointments/" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": 1,
    "hospital_id": "h001",
    "hospital_name": "市人民医院",
    "department": "心血管内科",
    "appointment_date": "2024-01-15T09:00:00"
  }'
```

### 📋 就医指导
```bash
curl "http://localhost:8000/api/guidance/appointment/1/full"
```

### 💊 用药管理
```bash
curl -X POST "http://localhost:8000/api/medications/schedule" \
  -H "Content-Type: application/json" \
  -d '{
    "medications": [
      {
        "name": "阿司匹林",
        "dosage": "100mg",
        "frequency": "每日1次",
        "timing": "晚饭后",
        "duration": "长期"
      }
    ]
  }'
```

## 常用命令

```bash
# 启动服务
./start.sh

# 查看API文档
open http://localhost:8000/docs

# 运行示例
python examples/example_usage.py

# 查看日志
tail -f logs/medical_escort_*.log

# 停止服务
# 按 Ctrl+C
```

## 下一步

- 📖 阅读[使用手册](使用手册.md)了解详细功能
- 🔧 查看[开发文档](开发文档.md)进行二次开发
- 💡 运行 `examples/example_usage.py` 查看完整示例

## 遇到问题？

### 问题1: 启动失败 - ModuleNotFoundError

**解决方案**:
```bash
pip install -r requirements.txt
```

### 问题2: OpenAI API错误

**解决方案**:
- 检查 `.env` 文件中的 `OPENAI_API_KEY` 是否正确
- 确保API Key有效且有余额

### 问题3: 数据库错误

**解决方案**:
```bash
python -c "from database import init_db; init_db()"
```

### 问题4: 端口被占用

**解决方案**:
```bash
# 在 .env 文件中修改端口
PORT=8001
```

## 获取帮助

- 📧 邮件: support@medical-escort.com
- 💬 Issue: GitHub Issues
- 📞 电话: 400-XXX-XXXX

---

祝您使用愉快！❤️




